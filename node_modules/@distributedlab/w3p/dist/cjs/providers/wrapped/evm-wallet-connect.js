"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
Object.defineProperty(exports, "WalletConnectEvmProvider", {
    enumerable: true,
    get: function() {
        return WalletConnectEvmProvider;
    }
});
const _ethers = require("ethers");
const _isEmpty = _interop_require_default(require("lodash/isEmpty"));
const _enums = require("../../enums");
const _errors = require("../../errors");
const _eth = require("../../helpers/eth");
const _walletconnect = require("../../helpers/wallet-connect");
const _provider = require("../../provider");
const _eventbus = require("./_event-bus");
function asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) {
    try {
        var info = gen[key](arg);
        var value = info.value;
    } catch (error) {
        reject(error);
        return;
    }
    if (info.done) {
        resolve(value);
    } else {
        Promise.resolve(value).then(_next, _throw);
    }
}
function _async_to_generator(fn) {
    return function() {
        var self = this, args = arguments;
        return new Promise(function(resolve, reject) {
            var gen = fn.apply(self, args);
            function _next(value) {
                asyncGeneratorStep(gen, resolve, reject, _next, _throw, "next", value);
            }
            function _throw(err) {
                asyncGeneratorStep(gen, resolve, reject, _next, _throw, "throw", err);
            }
            _next(undefined);
        });
    };
}
function _define_property(obj, key, value) {
    if (key in obj) {
        Object.defineProperty(obj, key, {
            value: value,
            enumerable: true,
            configurable: true,
            writable: true
        });
    } else {
        obj[key] = value;
    }
    return obj;
}
function _interop_require_default(obj) {
    return obj && obj.__esModule ? obj : {
        default: obj
    };
}
let WalletConnectEvmProvider = class WalletConnectEvmProvider extends _eventbus.ProviderEventBus {
    static get providerType() {
        return _enums.PROVIDERS.WalletConnect;
    }
    get rawProvider() {
        return this.universalProvider;
    }
    get ethProvider() {
        var _this_universalProvider;
        if (!((_this_universalProvider = this.universalProvider) === null || _this_universalProvider === void 0 ? void 0 : _this_universalProvider.session)) {
            return null;
        }
        return new _ethers.providers.Web3Provider(this.universalProvider);
    }
    get chainType() {
        return _enums.CHAIN_TYPES.EVM;
    }
    get isConnected() {
        return Boolean(this.chainId && this.address);
    }
    init() {
        var _this = this;
        return _async_to_generator(function*() {
            yield _this.checkForPersistedSession();
            yield _this.setListeners();
            yield _this.setCustomRpcs();
            _this.emit(_enums.PROVIDER_EVENT_BUS_EVENTS.Initiated, _this.defaultEventPayload);
        })();
    }
    connect() {
        var _this = this;
        return _async_to_generator(function*() {
            var _this_universalProvider_session_namespaces_eip155_chains_, _this_universalProvider_session_namespaces_eip155_chains, _this_universalProvider_session_namespaces_eip155, _this_universalProvider_session_namespaces, _this_universalProvider_session, _this_universalProvider;
            if (!_this.universalProvider) {
                throw new _errors.errors.ProviderNotInitializedError();
            }
            yield _this.universalProvider.connect({
                namespaces: (0, _walletconnect.createWalletConnectEthNamespace)(),
                optionalNamespaces: (0, _walletconnect.createWalletConnectEthNamespace)(),
                skipPairing: true
            });
            yield _this.universalProvider.enable();
            const accounts = yield _this.universalProvider.request({
                method: 'eth_requestAccounts'
            });
            _this.chainId = (_this_universalProvider = _this.universalProvider) === null || _this_universalProvider === void 0 ? void 0 : (_this_universalProvider_session = _this_universalProvider.session) === null || _this_universalProvider_session === void 0 ? void 0 : (_this_universalProvider_session_namespaces = _this_universalProvider_session.namespaces) === null || _this_universalProvider_session_namespaces === void 0 ? void 0 : (_this_universalProvider_session_namespaces_eip155 = _this_universalProvider_session_namespaces.eip155) === null || _this_universalProvider_session_namespaces_eip155 === void 0 ? void 0 : (_this_universalProvider_session_namespaces_eip155_chains = _this_universalProvider_session_namespaces_eip155.chains) === null || _this_universalProvider_session_namespaces_eip155_chains === void 0 ? void 0 : (_this_universalProvider_session_namespaces_eip155_chains_ = _this_universalProvider_session_namespaces_eip155_chains[0]) === null || _this_universalProvider_session_namespaces_eip155_chains_ === void 0 ? void 0 : _this_universalProvider_session_namespaces_eip155_chains_.split(':')[1];
            _this.address = accounts === null || accounts === void 0 ? void 0 : accounts[0];
            _this.emit(_enums.PROVIDER_EVENT_BUS_EVENTS.AccountChanged, _this.defaultEventPayload);
            _this.emit(_this.isConnected ? _enums.PROVIDER_EVENT_BUS_EVENTS.Connect : _enums.PROVIDER_EVENT_BUS_EVENTS.Disconnect, _this.defaultEventPayload);
        })();
    }
    disconnect() {
        var _this = this;
        return _async_to_generator(function*() {
            if (!_this.universalProvider) {
                throw new _errors.errors.ProviderNotInitializedError();
            }
            yield _this.universalProvider.disconnect();
            _this.chainId = undefined;
            _this.address = undefined;
            _this.emit(_enums.PROVIDER_EVENT_BUS_EVENTS.Disconnect, _this.defaultEventPayload);
        })();
    }
    checkForPersistedSession() {
        var _this = this;
        return _async_to_generator(function*() {
            var _this_universalProvider, _this_universalProvider_namespaces, _this_universalProvider1, _this_universalProvider_session_namespaces_eip155_accounts__split, _this_universalProvider_session_namespaces_eip155_accounts_, _this_universalProvider_session_namespaces_eip155_accounts, _this_universalProvider_session_namespaces_eip155, _this_universalProvider_session_namespaces, _this_universalProvider_session, _this_universalProvider2;
            if (!_this.universalProvider) {
                throw new _errors.errors.ProviderNotInitializedError();
            }
            if (!((_this_universalProvider = _this.universalProvider) === null || _this_universalProvider === void 0 ? void 0 : _this_universalProvider.session)) return;
            _this.chainId = (_this_universalProvider1 = _this.universalProvider) === null || _this_universalProvider1 === void 0 ? void 0 : (_this_universalProvider_namespaces = _this_universalProvider1.namespaces) === null || _this_universalProvider_namespaces === void 0 ? void 0 : _this_universalProvider_namespaces.eip155.defaultChain;
            _this.address = (_this_universalProvider2 = _this.universalProvider) === null || _this_universalProvider2 === void 0 ? void 0 : (_this_universalProvider_session = _this_universalProvider2.session) === null || _this_universalProvider_session === void 0 ? void 0 : (_this_universalProvider_session_namespaces = _this_universalProvider_session.namespaces) === null || _this_universalProvider_session_namespaces === void 0 ? void 0 : (_this_universalProvider_session_namespaces_eip155 = _this_universalProvider_session_namespaces.eip155) === null || _this_universalProvider_session_namespaces_eip155 === void 0 ? void 0 : (_this_universalProvider_session_namespaces_eip155_accounts = _this_universalProvider_session_namespaces_eip155.accounts) === null || _this_universalProvider_session_namespaces_eip155_accounts === void 0 ? void 0 : (_this_universalProvider_session_namespaces_eip155_accounts_ = _this_universalProvider_session_namespaces_eip155_accounts[0]) === null || _this_universalProvider_session_namespaces_eip155_accounts_ === void 0 ? void 0 : (_this_universalProvider_session_namespaces_eip155_accounts__split = _this_universalProvider_session_namespaces_eip155_accounts_.split(':')) === null || _this_universalProvider_session_namespaces_eip155_accounts__split === void 0 ? void 0 : _this_universalProvider_session_namespaces_eip155_accounts__split[2];
        })();
    }
    getAddressUrl(chain, address) {
        return (0, _eth.getEthExplorerAddressUrl)(chain, address);
    }
    getTxUrl(chain, txHash) {
        return (0, _eth.getEthExplorerTxUrl)(chain, txHash);
    }
    getHashFromTx(txResponse) {
        return txResponse.transactionHash;
    }
    /**
   * @description Switch the chain with WalletConnect Provider.
   * You should always add a network first with the proper method
   * {@link Provider.setChainDetails} and then change it.
   */ switchChain(chainId) {
        var _this = this;
        return _async_to_generator(function*() {
            var _this_universalProvider;
            if (!_this.ethProvider) {
                throw new _errors.errors.ProviderDisconnected();
            }
            if (!_provider.Provider.chainsDetails) {
                throw new _errors.errors.ProviderChainDetailsNotFoundError();
            }
            const foundChain = _provider.Provider.chainsDetails[chainId];
            if (!foundChain) {
                throw new _errors.errors.ProviderChainNotFoundError();
            }
            yield _this.addChain(foundChain);
            (_this_universalProvider = _this.universalProvider) === null || _this_universalProvider === void 0 ? void 0 : _this_universalProvider.setDefaultChain(`eip155:${Number(foundChain.id)}`, foundChain.rpcUrl);
            yield (0, _eth.requestSwitchEthChain)(_this.ethProvider, foundChain.id);
        })();
    }
    setCustomRpcs() {
        var _this = this;
        return _async_to_generator(function*() {
            if ((0, _isEmpty.default)(_provider.Provider.chainsDetails)) {
                return;
            }
            yield Promise.all(Object.entries(_provider.Provider.chainsDetails).map(function() {
                var _ref = _async_to_generator(function*([chainId, chainInfo]) {
                    var _this_universalProvider_rpcProviders_eip155_httpProviders, _this_universalProvider_rpcProviders_eip155, _this_universalProvider_rpcProviders, _this_universalProvider;
                    const rpcProvider = (_this_universalProvider = _this.universalProvider) === null || _this_universalProvider === void 0 ? void 0 : (_this_universalProvider_rpcProviders = _this_universalProvider.rpcProviders) === null || _this_universalProvider_rpcProviders === void 0 ? void 0 : (_this_universalProvider_rpcProviders_eip155 = _this_universalProvider_rpcProviders.eip155) === null || _this_universalProvider_rpcProviders_eip155 === void 0 ? void 0 : (_this_universalProvider_rpcProviders_eip155_httpProviders = _this_universalProvider_rpcProviders_eip155.httpProviders) === null || _this_universalProvider_rpcProviders_eip155_httpProviders === void 0 ? void 0 : _this_universalProvider_rpcProviders_eip155_httpProviders[chainId];
                    if (rpcProvider) {
                        yield rpcProvider.connect(chainInfo.rpcUrl);
                    }
                });
                return function(_) {
                    return _ref.apply(this, arguments);
                };
            }()));
        })();
    }
    addChain(chain) {
        var _this = this;
        return _async_to_generator(function*() {
            if (!_this.ethProvider) {
                throw new _errors.errors.ProviderDisconnected();
            }
            yield (0, _eth.requestAddEthChain)(_this.ethProvider, chain);
        })();
    }
    signAndSendTx(tx) {
        var _this = this;
        return _async_to_generator(function*() {
            var _this_ethProvider;
            if (!_this.universalProvider) {
                throw new _errors.errors.ProviderNotInitializedError();
            }
            _this.emit(_enums.PROVIDER_EVENT_BUS_EVENTS.BeforeTxSent, {
                txBody: tx
            });
            const transactionResponse = yield (_this_ethProvider = _this.ethProvider) === null || _this_ethProvider === void 0 ? void 0 : _this_ethProvider.send('eth_sendTransaction', [
                tx
            ]);
            _this.emit(_enums.PROVIDER_EVENT_BUS_EVENTS.TxSent, {
                txHash: transactionResponse === null || transactionResponse === void 0 ? void 0 : transactionResponse.hash
            });
            const receipt = yield transactionResponse === null || transactionResponse === void 0 ? void 0 : transactionResponse.wait();
            _this.emit(_enums.PROVIDER_EVENT_BUS_EVENTS.TxConfirmed, {
                txResponse: receipt
            });
            return receipt;
        })();
    }
    signMessage(message) {
        var _this = this;
        return _async_to_generator(function*() {
            var _this_ethProvider;
            if (!_this.ethProvider || !_this.address) {
                throw new _errors.errors.ProviderDisconnected();
            }
            return (_this_ethProvider = _this.ethProvider) === null || _this_ethProvider === void 0 ? void 0 : _this_ethProvider.send('personal_sign', [
                _ethers.utils.hexlify(_ethers.utils.toUtf8Bytes(message)),
                _this.address.toLowerCase()
            ]);
        })();
    }
    get defaultEventPayload() {
        return {
            address: this.address,
            chainId: this.chainId,
            isConnected: this.isConnected,
            walletConnectDisplayUri: this.walletConnectDisplayUri
        };
    }
    setListeners() {
        var _this = this;
        return _async_to_generator(function*() {
            if (!_this.universalProvider) {
                throw new _errors.errors.ProviderNotInitializedError();
            }
            _this.universalProvider.on('session_event', (e)=>{
                var _e_params, _e_params_event_data__split, _e_params_event_data_, _e_params_event_data, _e_params_event, _e_params1;
                var _e_params_chainId_split_;
                _this.chainId = (_e_params_chainId_split_ = e === null || e === void 0 ? void 0 : (_e_params = e.params) === null || _e_params === void 0 ? void 0 : _e_params.chainId.split(':')[1]) !== null && _e_params_chainId_split_ !== void 0 ? _e_params_chainId_split_ : _this.chainId;
                var _e_params_event_data__split_;
                _this.address = (_e_params_event_data__split_ = e === null || e === void 0 ? void 0 : (_e_params1 = e.params) === null || _e_params1 === void 0 ? void 0 : (_e_params_event = _e_params1.event) === null || _e_params_event === void 0 ? void 0 : (_e_params_event_data = _e_params_event.data) === null || _e_params_event_data === void 0 ? void 0 : (_e_params_event_data_ = _e_params_event_data[0]) === null || _e_params_event_data_ === void 0 ? void 0 : (_e_params_event_data__split = _e_params_event_data_.split(':')) === null || _e_params_event_data__split === void 0 ? void 0 : _e_params_event_data__split[2]) !== null && _e_params_event_data__split_ !== void 0 ? _e_params_event_data__split_ : _this.address;
                _this.emit(_enums.PROVIDER_EVENT_BUS_EVENTS.AccountChanged, _this.defaultEventPayload);
                _this.emit(_enums.PROVIDER_EVENT_BUS_EVENTS.ChainChanged, _this.defaultEventPayload);
                _this.emit(_this.isConnected ? _enums.PROVIDER_EVENT_BUS_EVENTS.Connect : _enums.PROVIDER_EVENT_BUS_EVENTS.Disconnect, _this.defaultEventPayload);
            });
            _this.universalProvider.on('session_delete', ()=>{
                _this.emit(_enums.PROVIDER_EVENT_BUS_EVENTS.Disconnect, _this.defaultEventPayload);
            });
            _this.universalProvider.on('display_uri', (uri)=>{
                _this.walletConnectDisplayUri = uri;
                _this.emit(_enums.PROVIDER_EVENT_BUS_EVENTS.WalletConnectDisplayUri, _this.defaultEventPayload);
            });
        })();
    }
    /**
   * import { Provider } from '@distributed/w3p'
   * import UniversalProvider from '@walletconnect/universal-provider'
   *
   * const universalProvider = new UniversalProvider({
   *   projectId,
   *   relayUrl,
   *   logger,
   * })
   *
   * const provider = new Provider(WalletConnectEvmProvider)
   * provider.init(providerInstance, listeners)
   * @param universalProvider
   */ constructor(universalProvider){
        super();
        _define_property(this, "universalProvider", void 0);
        _define_property(this, "walletConnectDisplayUri", '');
        _define_property(this, "chainId", void 0);
        _define_property(this, "address", void 0);
        this.universalProvider = universalProvider;
    }
} /*#__PURE__*/  /*#__PURE__*/ ;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9wcm92aWRlcnMvd3JhcHBlZC9ldm0td2FsbGV0LWNvbm5lY3QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFVuaXZlcnNhbFByb3ZpZGVyIGZyb20gJ0B3YWxsZXRjb25uZWN0L3VuaXZlcnNhbC1wcm92aWRlcidcbmltcG9ydCB7IHByb3ZpZGVycywgdXRpbHMgfSBmcm9tICdldGhlcnMnXG5pbXBvcnQgaXNFbXB0eSBmcm9tICdsb2Rhc2gvaXNFbXB0eSdcblxuaW1wb3J0IHsgQ0hBSU5fVFlQRVMsIFBST1ZJREVSX0VWRU5UX0JVU19FVkVOVFMsIFBST1ZJREVSUyB9IGZyb20gJ0AvZW51bXMnXG5pbXBvcnQgeyBlcnJvcnMgfSBmcm9tICdAL2Vycm9ycydcbmltcG9ydCB7XG4gIGdldEV0aEV4cGxvcmVyQWRkcmVzc1VybCxcbiAgZ2V0RXRoRXhwbG9yZXJUeFVybCxcbiAgcmVxdWVzdEFkZEV0aENoYWluLFxuICByZXF1ZXN0U3dpdGNoRXRoQ2hhaW4sXG59IGZyb20gJ0AvaGVscGVycy9ldGgnXG5pbXBvcnQgeyBjcmVhdGVXYWxsZXRDb25uZWN0RXRoTmFtZXNwYWNlIH0gZnJvbSAnQC9oZWxwZXJzL3dhbGxldC1jb25uZWN0J1xuaW1wb3J0IHsgUHJvdmlkZXIgfSBmcm9tICdAL3Byb3ZpZGVyJ1xuaW1wb3J0IHR5cGUge1xuICBDaGFpbixcbiAgQ2hhaW5JZCxcbiAgRXRoVHJhbnNhY3Rpb25SZXNwb25zZSxcbiAgUHJvdmlkZXJQcm94eSxcbiAgUmF3UHJvdmlkZXIsXG4gIFRyYW5zYWN0aW9uUmVzcG9uc2UsXG4gIFR4UmVxdWVzdEJvZHksXG59IGZyb20gJ0AvdHlwZXMnXG5cbmltcG9ydCB7IFByb3ZpZGVyRXZlbnRCdXMgfSBmcm9tICcuLi93cmFwcGVkL19ldmVudC1idXMnXG5cbnR5cGUgV2FsbGV0Q29ubmVjdFNlc3Npb25FdmVudCA9IHtcbiAgcGFyYW1zOiB7XG4gICAgY2hhaW5JZDogc3RyaW5nXG4gICAgZXZlbnQ6IHtcbiAgICAgIGRhdGE6IHN0cmluZ1tdXG4gICAgfVxuICB9XG59XG5cbmV4cG9ydCBjbGFzcyBXYWxsZXRDb25uZWN0RXZtUHJvdmlkZXJcbiAgZXh0ZW5kcyBQcm92aWRlckV2ZW50QnVzXG4gIGltcGxlbWVudHMgUHJvdmlkZXJQcm94eVxue1xuICB1bml2ZXJzYWxQcm92aWRlcjogVW5pdmVyc2FsUHJvdmlkZXJcbiAgd2FsbGV0Q29ubmVjdERpc3BsYXlVcmkgPSAnJ1xuXG4gIGNoYWluSWQ/OiBDaGFpbklkXG4gIGFkZHJlc3M/OiBzdHJpbmdcblxuICAvKipcbiAgICogaW1wb3J0IHsgUHJvdmlkZXIgfSBmcm9tICdAZGlzdHJpYnV0ZWQvdzNwJ1xuICAgKiBpbXBvcnQgVW5pdmVyc2FsUHJvdmlkZXIgZnJvbSAnQHdhbGxldGNvbm5lY3QvdW5pdmVyc2FsLXByb3ZpZGVyJ1xuICAgKlxuICAgKiBjb25zdCB1bml2ZXJzYWxQcm92aWRlciA9IG5ldyBVbml2ZXJzYWxQcm92aWRlcih7XG4gICAqICAgcHJvamVjdElkLFxuICAgKiAgIHJlbGF5VXJsLFxuICAgKiAgIGxvZ2dlcixcbiAgICogfSlcbiAgICpcbiAgICogY29uc3QgcHJvdmlkZXIgPSBuZXcgUHJvdmlkZXIoV2FsbGV0Q29ubmVjdEV2bVByb3ZpZGVyKVxuICAgKiBwcm92aWRlci5pbml0KHByb3ZpZGVySW5zdGFuY2UsIGxpc3RlbmVycylcbiAgICogQHBhcmFtIHVuaXZlcnNhbFByb3ZpZGVyXG4gICAqL1xuICBjb25zdHJ1Y3Rvcih1bml2ZXJzYWxQcm92aWRlcjogUmF3UHJvdmlkZXIpIHtcbiAgICBzdXBlcigpXG5cbiAgICB0aGlzLnVuaXZlcnNhbFByb3ZpZGVyID0gdW5pdmVyc2FsUHJvdmlkZXIgYXMgdW5rbm93biBhcyBVbml2ZXJzYWxQcm92aWRlclxuICB9XG5cbiAgc3RhdGljIGdldCBwcm92aWRlclR5cGUoKTogUFJPVklERVJTIHtcbiAgICByZXR1cm4gUFJPVklERVJTLldhbGxldENvbm5lY3RcbiAgfVxuXG4gIGdldCByYXdQcm92aWRlcigpOiBSYXdQcm92aWRlciB7XG4gICAgcmV0dXJuIHRoaXMudW5pdmVyc2FsUHJvdmlkZXIgYXMgdW5rbm93biBhcyBSYXdQcm92aWRlclxuICB9XG5cbiAgZ2V0IGV0aFByb3ZpZGVyKCk6IHByb3ZpZGVycy5XZWIzUHJvdmlkZXIgfCBudWxsIHtcbiAgICBpZiAoIXRoaXMudW5pdmVyc2FsUHJvdmlkZXI/LnNlc3Npb24pIHtcbiAgICAgIHJldHVybiBudWxsXG4gICAgfVxuXG4gICAgcmV0dXJuIG5ldyBwcm92aWRlcnMuV2ViM1Byb3ZpZGVyKHRoaXMudW5pdmVyc2FsUHJvdmlkZXIpXG4gIH1cblxuICBnZXQgY2hhaW5UeXBlKCk6IENIQUlOX1RZUEVTIHtcbiAgICByZXR1cm4gQ0hBSU5fVFlQRVMuRVZNXG4gIH1cblxuICBnZXQgaXNDb25uZWN0ZWQoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIEJvb2xlYW4odGhpcy5jaGFpbklkICYmIHRoaXMuYWRkcmVzcylcbiAgfVxuXG4gIGFzeW5jIGluaXQoKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgYXdhaXQgdGhpcy5jaGVja0ZvclBlcnNpc3RlZFNlc3Npb24oKVxuXG4gICAgYXdhaXQgdGhpcy5zZXRMaXN0ZW5lcnMoKVxuXG4gICAgYXdhaXQgdGhpcy5zZXRDdXN0b21ScGNzKClcblxuICAgIHRoaXMuZW1pdChQUk9WSURFUl9FVkVOVF9CVVNfRVZFTlRTLkluaXRpYXRlZCwgdGhpcy5kZWZhdWx0RXZlbnRQYXlsb2FkKVxuICB9XG5cbiAgYXN5bmMgY29ubmVjdCgpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBpZiAoIXRoaXMudW5pdmVyc2FsUHJvdmlkZXIpIHtcbiAgICAgIHRocm93IG5ldyBlcnJvcnMuUHJvdmlkZXJOb3RJbml0aWFsaXplZEVycm9yKClcbiAgICB9XG5cbiAgICBhd2FpdCB0aGlzLnVuaXZlcnNhbFByb3ZpZGVyLmNvbm5lY3Qoe1xuICAgICAgbmFtZXNwYWNlczogY3JlYXRlV2FsbGV0Q29ubmVjdEV0aE5hbWVzcGFjZSgpLFxuICAgICAgb3B0aW9uYWxOYW1lc3BhY2VzOiBjcmVhdGVXYWxsZXRDb25uZWN0RXRoTmFtZXNwYWNlKCksXG4gICAgICBza2lwUGFpcmluZzogdHJ1ZSxcbiAgICB9KVxuXG4gICAgYXdhaXQgdGhpcy51bml2ZXJzYWxQcm92aWRlci5lbmFibGUoKVxuXG4gICAgY29uc3QgYWNjb3VudHMgPSBhd2FpdCB0aGlzLnVuaXZlcnNhbFByb3ZpZGVyLnJlcXVlc3Q8c3RyaW5nW10+KHtcbiAgICAgIG1ldGhvZDogJ2V0aF9yZXF1ZXN0QWNjb3VudHMnLFxuICAgIH0pXG5cbiAgICB0aGlzLmNoYWluSWQgPVxuICAgICAgdGhpcy51bml2ZXJzYWxQcm92aWRlcj8uc2Vzc2lvbj8ubmFtZXNwYWNlcz8uZWlwMTU1Py5jaGFpbnM/LlswXT8uc3BsaXQoXG4gICAgICAgICc6JyxcbiAgICAgIClbMV1cblxuICAgIHRoaXMuYWRkcmVzcyA9IGFjY291bnRzPy5bMF1cblxuICAgIHRoaXMuZW1pdChcbiAgICAgIFBST1ZJREVSX0VWRU5UX0JVU19FVkVOVFMuQWNjb3VudENoYW5nZWQsXG4gICAgICB0aGlzLmRlZmF1bHRFdmVudFBheWxvYWQsXG4gICAgKVxuXG4gICAgdGhpcy5lbWl0KFxuICAgICAgdGhpcy5pc0Nvbm5lY3RlZFxuICAgICAgICA/IFBST1ZJREVSX0VWRU5UX0JVU19FVkVOVFMuQ29ubmVjdFxuICAgICAgICA6IFBST1ZJREVSX0VWRU5UX0JVU19FVkVOVFMuRGlzY29ubmVjdCxcbiAgICAgIHRoaXMuZGVmYXVsdEV2ZW50UGF5bG9hZCxcbiAgICApXG4gIH1cblxuICBhc3luYyBkaXNjb25uZWN0KCkge1xuICAgIGlmICghdGhpcy51bml2ZXJzYWxQcm92aWRlcikge1xuICAgICAgdGhyb3cgbmV3IGVycm9ycy5Qcm92aWRlck5vdEluaXRpYWxpemVkRXJyb3IoKVxuICAgIH1cbiAgICBhd2FpdCB0aGlzLnVuaXZlcnNhbFByb3ZpZGVyLmRpc2Nvbm5lY3QoKVxuICAgIHRoaXMuY2hhaW5JZCA9IHVuZGVmaW5lZFxuICAgIHRoaXMuYWRkcmVzcyA9IHVuZGVmaW5lZFxuICAgIHRoaXMuZW1pdChQUk9WSURFUl9FVkVOVF9CVVNfRVZFTlRTLkRpc2Nvbm5lY3QsIHRoaXMuZGVmYXVsdEV2ZW50UGF5bG9hZClcbiAgfVxuXG4gIGFzeW5jIGNoZWNrRm9yUGVyc2lzdGVkU2Vzc2lvbigpIHtcbiAgICBpZiAoIXRoaXMudW5pdmVyc2FsUHJvdmlkZXIpIHtcbiAgICAgIHRocm93IG5ldyBlcnJvcnMuUHJvdmlkZXJOb3RJbml0aWFsaXplZEVycm9yKClcbiAgICB9XG5cbiAgICBpZiAoIXRoaXMudW5pdmVyc2FsUHJvdmlkZXI/LnNlc3Npb24pIHJldHVyblxuXG4gICAgdGhpcy5jaGFpbklkID0gdGhpcy51bml2ZXJzYWxQcm92aWRlcj8ubmFtZXNwYWNlcz8uZWlwMTU1LmRlZmF1bHRDaGFpblxuXG4gICAgdGhpcy5hZGRyZXNzID1cbiAgICAgIHRoaXMudW5pdmVyc2FsUHJvdmlkZXI/LnNlc3Npb24/Lm5hbWVzcGFjZXM/LmVpcDE1NT8uYWNjb3VudHM/LlswXT8uc3BsaXQoXG4gICAgICAgICc6JyxcbiAgICAgICk/LlsyXVxuICB9XG5cbiAgZ2V0QWRkcmVzc1VybChjaGFpbjogQ2hhaW4sIGFkZHJlc3M6IHN0cmluZyk6IHN0cmluZyB7XG4gICAgcmV0dXJuIGdldEV0aEV4cGxvcmVyQWRkcmVzc1VybChjaGFpbiwgYWRkcmVzcylcbiAgfVxuXG4gIGdldFR4VXJsKGNoYWluOiBDaGFpbiwgdHhIYXNoOiBzdHJpbmcpOiBzdHJpbmcge1xuICAgIHJldHVybiBnZXRFdGhFeHBsb3JlclR4VXJsKGNoYWluLCB0eEhhc2gpXG4gIH1cblxuICBnZXRIYXNoRnJvbVR4KHR4UmVzcG9uc2U6IFRyYW5zYWN0aW9uUmVzcG9uc2UpOiBzdHJpbmcge1xuICAgIHJldHVybiAodHhSZXNwb25zZSBhcyBFdGhUcmFuc2FjdGlvblJlc3BvbnNlKS50cmFuc2FjdGlvbkhhc2hcbiAgfVxuXG4gIC8qKlxuICAgKiBAZGVzY3JpcHRpb24gU3dpdGNoIHRoZSBjaGFpbiB3aXRoIFdhbGxldENvbm5lY3QgUHJvdmlkZXIuXG4gICAqIFlvdSBzaG91bGQgYWx3YXlzIGFkZCBhIG5ldHdvcmsgZmlyc3Qgd2l0aCB0aGUgcHJvcGVyIG1ldGhvZFxuICAgKiB7QGxpbmsgUHJvdmlkZXIuc2V0Q2hhaW5EZXRhaWxzfSBhbmQgdGhlbiBjaGFuZ2UgaXQuXG4gICAqL1xuXG4gIGFzeW5jIHN3aXRjaENoYWluKGNoYWluSWQ6IENoYWluSWQpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBpZiAoIXRoaXMuZXRoUHJvdmlkZXIpIHtcbiAgICAgIHRocm93IG5ldyBlcnJvcnMuUHJvdmlkZXJEaXNjb25uZWN0ZWQoKVxuICAgIH1cblxuICAgIGlmICghUHJvdmlkZXIuY2hhaW5zRGV0YWlscykge1xuICAgICAgdGhyb3cgbmV3IGVycm9ycy5Qcm92aWRlckNoYWluRGV0YWlsc05vdEZvdW5kRXJyb3IoKVxuICAgIH1cblxuICAgIGNvbnN0IGZvdW5kQ2hhaW4gPSBQcm92aWRlci5jaGFpbnNEZXRhaWxzW2NoYWluSWRdXG5cbiAgICBpZiAoIWZvdW5kQ2hhaW4pIHtcbiAgICAgIHRocm93IG5ldyBlcnJvcnMuUHJvdmlkZXJDaGFpbk5vdEZvdW5kRXJyb3IoKVxuICAgIH1cblxuICAgIGF3YWl0IHRoaXMuYWRkQ2hhaW4oZm91bmRDaGFpbilcblxuICAgIHRoaXMudW5pdmVyc2FsUHJvdmlkZXI/LnNldERlZmF1bHRDaGFpbihcbiAgICAgIGBlaXAxNTU6JHtOdW1iZXIoZm91bmRDaGFpbi5pZCl9YCxcbiAgICAgIGZvdW5kQ2hhaW4ucnBjVXJsLFxuICAgIClcblxuICAgIGF3YWl0IHJlcXVlc3RTd2l0Y2hFdGhDaGFpbih0aGlzLmV0aFByb3ZpZGVyLCBmb3VuZENoYWluLmlkKVxuICB9XG5cbiAgYXN5bmMgc2V0Q3VzdG9tUnBjcygpIHtcbiAgICBpZiAoaXNFbXB0eShQcm92aWRlci5jaGFpbnNEZXRhaWxzKSkge1xuICAgICAgcmV0dXJuXG4gICAgfVxuICAgIGF3YWl0IFByb21pc2UuYWxsKFxuICAgICAgT2JqZWN0LmVudHJpZXMoUHJvdmlkZXIuY2hhaW5zRGV0YWlscykubWFwKFxuICAgICAgICBhc3luYyAoW2NoYWluSWQsIGNoYWluSW5mb10pID0+IHtcbiAgICAgICAgICBjb25zdCBycGNQcm92aWRlciA9XG4gICAgICAgICAgICB0aGlzLnVuaXZlcnNhbFByb3ZpZGVyPy5ycGNQcm92aWRlcnM/LmVpcDE1NT8uaHR0cFByb3ZpZGVycz8uW1xuICAgICAgICAgICAgICBjaGFpbklkXG4gICAgICAgICAgICBdXG4gICAgICAgICAgaWYgKHJwY1Byb3ZpZGVyKSB7XG4gICAgICAgICAgICBhd2FpdCBycGNQcm92aWRlci5jb25uZWN0KGNoYWluSW5mby5ycGNVcmwpXG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgKSxcbiAgICApXG4gIH1cblxuICBhc3luYyBhZGRDaGFpbihjaGFpbjogQ2hhaW4pOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBpZiAoIXRoaXMuZXRoUHJvdmlkZXIpIHtcbiAgICAgIHRocm93IG5ldyBlcnJvcnMuUHJvdmlkZXJEaXNjb25uZWN0ZWQoKVxuICAgIH1cblxuICAgIGF3YWl0IHJlcXVlc3RBZGRFdGhDaGFpbih0aGlzLmV0aFByb3ZpZGVyLCBjaGFpbilcbiAgfVxuXG4gIGFzeW5jIHNpZ25BbmRTZW5kVHgodHg6IFR4UmVxdWVzdEJvZHkpOiBQcm9taXNlPFRyYW5zYWN0aW9uUmVzcG9uc2U+IHtcbiAgICBpZiAoIXRoaXMudW5pdmVyc2FsUHJvdmlkZXIpIHtcbiAgICAgIHRocm93IG5ldyBlcnJvcnMuUHJvdmlkZXJOb3RJbml0aWFsaXplZEVycm9yKClcbiAgICB9XG5cbiAgICB0aGlzLmVtaXQoUFJPVklERVJfRVZFTlRfQlVTX0VWRU5UUy5CZWZvcmVUeFNlbnQsIHtcbiAgICAgIHR4Qm9keTogdHgsXG4gICAgfSlcblxuICAgIGNvbnN0IHRyYW5zYWN0aW9uUmVzcG9uc2UgPSBhd2FpdCB0aGlzLmV0aFByb3ZpZGVyPy5zZW5kKFxuICAgICAgJ2V0aF9zZW5kVHJhbnNhY3Rpb24nLFxuICAgICAgW3R4XSxcbiAgICApXG5cbiAgICB0aGlzLmVtaXQoUFJPVklERVJfRVZFTlRfQlVTX0VWRU5UUy5UeFNlbnQsIHtcbiAgICAgIHR4SGFzaDogdHJhbnNhY3Rpb25SZXNwb25zZT8uaGFzaCxcbiAgICB9KVxuXG4gICAgY29uc3QgcmVjZWlwdCA9IGF3YWl0IHRyYW5zYWN0aW9uUmVzcG9uc2U/LndhaXQoKVxuXG4gICAgdGhpcy5lbWl0KFBST1ZJREVSX0VWRU5UX0JVU19FVkVOVFMuVHhDb25maXJtZWQsIHtcbiAgICAgIHR4UmVzcG9uc2U6IHJlY2VpcHQsXG4gICAgfSlcblxuICAgIHJldHVybiByZWNlaXB0XG4gIH1cblxuICBhc3luYyBzaWduTWVzc2FnZShtZXNzYWdlOiBzdHJpbmcpOiBQcm9taXNlPHN0cmluZz4ge1xuICAgIGlmICghdGhpcy5ldGhQcm92aWRlciB8fCAhdGhpcy5hZGRyZXNzKSB7XG4gICAgICB0aHJvdyBuZXcgZXJyb3JzLlByb3ZpZGVyRGlzY29ubmVjdGVkKClcbiAgICB9XG5cbiAgICByZXR1cm4gdGhpcy5ldGhQcm92aWRlcj8uc2VuZCgncGVyc29uYWxfc2lnbicsIFtcbiAgICAgIHV0aWxzLmhleGxpZnkodXRpbHMudG9VdGY4Qnl0ZXMobWVzc2FnZSkpLFxuICAgICAgdGhpcy5hZGRyZXNzLnRvTG93ZXJDYXNlKCksXG4gICAgXSlcbiAgfVxuXG4gIGdldCBkZWZhdWx0RXZlbnRQYXlsb2FkKCkge1xuICAgIHJldHVybiB7XG4gICAgICBhZGRyZXNzOiB0aGlzLmFkZHJlc3MsXG4gICAgICBjaGFpbklkOiB0aGlzLmNoYWluSWQsXG4gICAgICBpc0Nvbm5lY3RlZDogdGhpcy5pc0Nvbm5lY3RlZCxcbiAgICAgIHdhbGxldENvbm5lY3REaXNwbGF5VXJpOiB0aGlzLndhbGxldENvbm5lY3REaXNwbGF5VXJpLFxuICAgIH1cbiAgfVxuXG4gIGFzeW5jIHNldExpc3RlbmVycygpIHtcbiAgICBpZiAoIXRoaXMudW5pdmVyc2FsUHJvdmlkZXIpIHtcbiAgICAgIHRocm93IG5ldyBlcnJvcnMuUHJvdmlkZXJOb3RJbml0aWFsaXplZEVycm9yKClcbiAgICB9XG5cbiAgICB0aGlzLnVuaXZlcnNhbFByb3ZpZGVyLm9uKFxuICAgICAgJ3Nlc3Npb25fZXZlbnQnLFxuICAgICAgKGU6IFdhbGxldENvbm5lY3RTZXNzaW9uRXZlbnQpID0+IHtcbiAgICAgICAgdGhpcy5jaGFpbklkID0gZT8ucGFyYW1zPy5jaGFpbklkLnNwbGl0KCc6JylbMV0gPz8gdGhpcy5jaGFpbklkXG5cbiAgICAgICAgdGhpcy5hZGRyZXNzID1cbiAgICAgICAgICBlPy5wYXJhbXM/LmV2ZW50Py5kYXRhPy5bMF0/LnNwbGl0KCc6Jyk/LlsyXSA/PyB0aGlzLmFkZHJlc3NcblxuICAgICAgICB0aGlzLmVtaXQoXG4gICAgICAgICAgUFJPVklERVJfRVZFTlRfQlVTX0VWRU5UUy5BY2NvdW50Q2hhbmdlZCxcbiAgICAgICAgICB0aGlzLmRlZmF1bHRFdmVudFBheWxvYWQsXG4gICAgICAgIClcblxuICAgICAgICB0aGlzLmVtaXQoXG4gICAgICAgICAgUFJPVklERVJfRVZFTlRfQlVTX0VWRU5UUy5DaGFpbkNoYW5nZWQsXG4gICAgICAgICAgdGhpcy5kZWZhdWx0RXZlbnRQYXlsb2FkLFxuICAgICAgICApXG5cbiAgICAgICAgdGhpcy5lbWl0KFxuICAgICAgICAgIHRoaXMuaXNDb25uZWN0ZWRcbiAgICAgICAgICAgID8gUFJPVklERVJfRVZFTlRfQlVTX0VWRU5UUy5Db25uZWN0XG4gICAgICAgICAgICA6IFBST1ZJREVSX0VWRU5UX0JVU19FVkVOVFMuRGlzY29ubmVjdCxcbiAgICAgICAgICB0aGlzLmRlZmF1bHRFdmVudFBheWxvYWQsXG4gICAgICAgIClcbiAgICAgIH0sXG4gICAgKVxuXG4gICAgdGhpcy51bml2ZXJzYWxQcm92aWRlci5vbignc2Vzc2lvbl9kZWxldGUnLCAoKSA9PiB7XG4gICAgICB0aGlzLmVtaXQoUFJPVklERVJfRVZFTlRfQlVTX0VWRU5UUy5EaXNjb25uZWN0LCB0aGlzLmRlZmF1bHRFdmVudFBheWxvYWQpXG4gICAgfSlcblxuICAgIHRoaXMudW5pdmVyc2FsUHJvdmlkZXIub24oJ2Rpc3BsYXlfdXJpJywgKHVyaTogc3RyaW5nKSA9PiB7XG4gICAgICB0aGlzLndhbGxldENvbm5lY3REaXNwbGF5VXJpID0gdXJpXG5cbiAgICAgIHRoaXMuZW1pdChcbiAgICAgICAgUFJPVklERVJfRVZFTlRfQlVTX0VWRU5UUy5XYWxsZXRDb25uZWN0RGlzcGxheVVyaSxcbiAgICAgICAgdGhpcy5kZWZhdWx0RXZlbnRQYXlsb2FkLFxuICAgICAgKVxuICAgIH0pXG4gIH1cbn1cbiJdLCJuYW1lcyI6WyJXYWxsZXRDb25uZWN0RXZtUHJvdmlkZXIiLCJQcm92aWRlckV2ZW50QnVzIiwicHJvdmlkZXJUeXBlIiwiUFJPVklERVJTIiwiV2FsbGV0Q29ubmVjdCIsInJhd1Byb3ZpZGVyIiwidW5pdmVyc2FsUHJvdmlkZXIiLCJldGhQcm92aWRlciIsInNlc3Npb24iLCJwcm92aWRlcnMiLCJXZWIzUHJvdmlkZXIiLCJjaGFpblR5cGUiLCJDSEFJTl9UWVBFUyIsIkVWTSIsImlzQ29ubmVjdGVkIiwiQm9vbGVhbiIsImNoYWluSWQiLCJhZGRyZXNzIiwiaW5pdCIsImNoZWNrRm9yUGVyc2lzdGVkU2Vzc2lvbiIsInNldExpc3RlbmVycyIsInNldEN1c3RvbVJwY3MiLCJlbWl0IiwiUFJPVklERVJfRVZFTlRfQlVTX0VWRU5UUyIsIkluaXRpYXRlZCIsImRlZmF1bHRFdmVudFBheWxvYWQiLCJjb25uZWN0IiwiZXJyb3JzIiwiUHJvdmlkZXJOb3RJbml0aWFsaXplZEVycm9yIiwibmFtZXNwYWNlcyIsImNyZWF0ZVdhbGxldENvbm5lY3RFdGhOYW1lc3BhY2UiLCJvcHRpb25hbE5hbWVzcGFjZXMiLCJza2lwUGFpcmluZyIsImVuYWJsZSIsImFjY291bnRzIiwicmVxdWVzdCIsIm1ldGhvZCIsImVpcDE1NSIsImNoYWlucyIsInNwbGl0IiwiQWNjb3VudENoYW5nZWQiLCJDb25uZWN0IiwiRGlzY29ubmVjdCIsImRpc2Nvbm5lY3QiLCJ1bmRlZmluZWQiLCJkZWZhdWx0Q2hhaW4iLCJnZXRBZGRyZXNzVXJsIiwiY2hhaW4iLCJnZXRFdGhFeHBsb3JlckFkZHJlc3NVcmwiLCJnZXRUeFVybCIsInR4SGFzaCIsImdldEV0aEV4cGxvcmVyVHhVcmwiLCJnZXRIYXNoRnJvbVR4IiwidHhSZXNwb25zZSIsInRyYW5zYWN0aW9uSGFzaCIsInN3aXRjaENoYWluIiwiUHJvdmlkZXJEaXNjb25uZWN0ZWQiLCJQcm92aWRlciIsImNoYWluc0RldGFpbHMiLCJQcm92aWRlckNoYWluRGV0YWlsc05vdEZvdW5kRXJyb3IiLCJmb3VuZENoYWluIiwiUHJvdmlkZXJDaGFpbk5vdEZvdW5kRXJyb3IiLCJhZGRDaGFpbiIsInNldERlZmF1bHRDaGFpbiIsIk51bWJlciIsImlkIiwicnBjVXJsIiwicmVxdWVzdFN3aXRjaEV0aENoYWluIiwiaXNFbXB0eSIsIlByb21pc2UiLCJhbGwiLCJPYmplY3QiLCJlbnRyaWVzIiwibWFwIiwiY2hhaW5JbmZvIiwicnBjUHJvdmlkZXIiLCJycGNQcm92aWRlcnMiLCJodHRwUHJvdmlkZXJzIiwicmVxdWVzdEFkZEV0aENoYWluIiwic2lnbkFuZFNlbmRUeCIsInR4IiwiQmVmb3JlVHhTZW50IiwidHhCb2R5IiwidHJhbnNhY3Rpb25SZXNwb25zZSIsInNlbmQiLCJUeFNlbnQiLCJoYXNoIiwicmVjZWlwdCIsIndhaXQiLCJUeENvbmZpcm1lZCIsInNpZ25NZXNzYWdlIiwibWVzc2FnZSIsInV0aWxzIiwiaGV4bGlmeSIsInRvVXRmOEJ5dGVzIiwidG9Mb3dlckNhc2UiLCJ3YWxsZXRDb25uZWN0RGlzcGxheVVyaSIsIm9uIiwiZSIsInBhcmFtcyIsImV2ZW50IiwiZGF0YSIsIkNoYWluQ2hhbmdlZCIsInVyaSIsIldhbGxldENvbm5lY3REaXNwbGF5VXJpIiwiY29uc3RydWN0b3IiXSwicmFuZ2VNYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OyIsIm1hcHBpbmdzIjoiOzs7OytCQW1DYUE7OztlQUFBQTs7O3dCQWxDb0I7a0RBQ2I7dUJBRThDO3dCQUMzQztxQkFNaEI7K0JBQ3lDOzBCQUN2QjswQkFXUTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBVzFCLElBQUEsQUFBTUEsMkJBQU4sTUFBTUEsaUNBQ0hDLDBCQUFnQjtJQTZCeEIsV0FBV0MsZUFBMEI7UUFDbkMsT0FBT0MsZ0JBQVMsQ0FBQ0MsYUFBYTtJQUNoQztJQUVBLElBQUlDLGNBQTJCO1FBQzdCLE9BQU8sSUFBSSxDQUFDQyxpQkFBaUI7SUFDL0I7SUFFQSxJQUFJQyxjQUE2QztZQUMxQztRQUFMLElBQUksR0FBQywwQkFBQSxJQUFJLENBQUNELGlCQUFpQixjQUF0Qiw4Q0FBQSx3QkFBd0JFLE9BQU8sR0FBRTtZQUNwQyxPQUFPO1FBQ1Q7UUFFQSxPQUFPLElBQUlDLGlCQUFTLENBQUNDLFlBQVksQ0FBQyxJQUFJLENBQUNKLGlCQUFpQjtJQUMxRDtJQUVBLElBQUlLLFlBQXlCO1FBQzNCLE9BQU9DLGtCQUFXLENBQUNDLEdBQUc7SUFDeEI7SUFFQSxJQUFJQyxjQUF1QjtRQUN6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