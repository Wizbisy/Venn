"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
Object.defineProperty(exports, "BaseSolanaProvider", {
    enumerable: true,
    get: function() {
        return BaseSolanaProvider;
    }
});
const _web3 = require("@solana/web3.js");
const _enums = require("../../enums");
const _solana = require("../../helpers/solana");
const _eventbus = require("./_event-bus");
function asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) {
    try {
        var info = gen[key](arg);
        var value = info.value;
    } catch (error) {
        reject(error);
        return;
    }
    if (info.done) {
        resolve(value);
    } else {
        Promise.resolve(value).then(_next, _throw);
    }
}
function _async_to_generator(fn) {
    return function() {
        var self = this, args = arguments;
        return new Promise(function(resolve, reject) {
            var gen = fn.apply(self, args);
            function _next(value) {
                asyncGeneratorStep(gen, resolve, reject, _next, _throw, "next", value);
            }
            function _throw(err) {
                asyncGeneratorStep(gen, resolve, reject, _next, _throw, "throw", err);
            }
            _next(undefined);
        });
    };
}
function _define_property(obj, key, value) {
    if (key in obj) {
        Object.defineProperty(obj, key, {
            value: value,
            enumerable: true,
            configurable: true,
            writable: true
        });
    } else {
        obj[key] = value;
    }
    return obj;
}
const getAddress = (publicKey)=>{
    return publicKey ? new _web3.PublicKey(publicKey).toBase58() : '';
};
let BaseSolanaProvider = class BaseSolanaProvider extends _eventbus.ProviderEventBus {
    get chainType() {
        return _enums.CHAIN_TYPES.Solana;
    }
    get isConnected() {
        return Boolean(this.chainId && this.address);
    }
    get defaultEventPayload() {
        return {
            chainId: this.chainId,
            address: this.address,
            isConnected: this.isConnected
        };
    }
    init() {
        var _this = this;
        return _async_to_generator(function*() {
            _this.setListeners();
            _this.address = getAddress(_this.provider.publicKey);
            _this.chainId = _enums.SOLANA_CHAINS.DevNet;
            _this.emit(_enums.PROVIDER_EVENT_BUS_EVENTS.Initiated, _this.defaultEventPayload);
        })();
    }
    switchChain(chainId) {
        var _this = this;
        return _async_to_generator(function*() {
            try {
                _this.chainId = chainId;
                _this.emit(_enums.PROVIDER_EVENT_BUS_EVENTS.ChainChanged, _this.defaultEventPayload);
            } catch (error) {
                (0, _solana.handleSolError)(error);
            }
        })();
    }
    connect() {
        var _this = this;
        return _async_to_generator(function*() {
            try {
                yield _this.provider.connect();
            } catch (error) {
                (0, _solana.handleSolError)(error);
            }
        })();
    }
    getAddressUrl(chain, address) {
        return (0, _solana.getSolExplorerAddressUrl)(chain, address);
    }
    getTxUrl(chain, txHash) {
        return (0, _solana.getSolExplorerTxUrl)(chain, txHash);
    }
    getHashFromTx(txResponse) {
        return txResponse;
    }
    signAndSendTx(// eslint-disable-next-line @typescript-eslint/ban-ts-comment
    // @ts-ignore
    // eslint-disable-next-line @typescript-eslint/no-unused-vars
    txRequestBody) {
        return _async_to_generator(function*() {
            throw new TypeError('Method should be implemented in extender class');
        })();
    }
    setListeners() {
        this.provider.on(_enums.PROVIDER_EVENTS.Connect, ()=>{
            this.address = getAddress(this.provider.publicKey);
            this.emit(_enums.PROVIDER_EVENT_BUS_EVENTS.Connect, this.defaultEventPayload);
        });
        this.provider.on(_enums.PROVIDER_EVENTS.Disconnect, ()=>{
            this.address = getAddress(this.provider.publicKey);
            this.emit(_enums.PROVIDER_EVENT_BUS_EVENTS.Disconnect, this.defaultEventPayload);
        });
        this.provider.on(_enums.PROVIDER_EVENTS.AccountChanged, ()=>{
            this.address = getAddress(this.provider.publicKey);
            this.emit(_enums.PROVIDER_EVENT_BUS_EVENTS.AccountChanged, this.defaultEventPayload);
        });
    }
    constructor(provider){
        super();
        _define_property(this, "provider", void 0);
        _define_property(this, "rawProvider", void 0);
        _define_property(this, "chainId", void 0);
        _define_property(this, "address", void 0);
        this.provider = provider;
        this.rawProvider = provider;
    }
};

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9wcm92aWRlcnMvd3JhcHBlZC9fYmFzZS1zb2xhbmEudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgUHVibGljS2V5IH0gZnJvbSAnQHNvbGFuYS93ZWIzLmpzJ1xuXG5pbXBvcnQge1xuICBDSEFJTl9UWVBFUyxcbiAgUFJPVklERVJfRVZFTlRfQlVTX0VWRU5UUyxcbiAgUFJPVklERVJfRVZFTlRTLFxuICBTT0xBTkFfQ0hBSU5TLFxufSBmcm9tICdAL2VudW1zJ1xuaW1wb3J0IHtcbiAgZ2V0U29sRXhwbG9yZXJBZGRyZXNzVXJsLFxuICBnZXRTb2xFeHBsb3JlclR4VXJsLFxuICBoYW5kbGVTb2xFcnJvcixcbn0gZnJvbSAnQC9oZWxwZXJzL3NvbGFuYSdcbmltcG9ydCB0eXBlIHtcbiAgQ2hhaW4sXG4gIENoYWluSWQsXG4gIFByb3ZpZGVyUHJveHksXG4gIFJhd1Byb3ZpZGVyLFxuICBTb2xhbmFQcm92aWRlcixcbiAgU29sYW5hUHJvdmlkZXJScGNFcnJvcixcbiAgU29sYW5hVHJhbnNhY3Rpb25SZXNwb25zZSxcbiAgVHJhbnNhY3Rpb25SZXNwb25zZSxcbiAgVHhSZXF1ZXN0Qm9keSxcbn0gZnJvbSAnQC90eXBlcydcblxuaW1wb3J0IHsgUHJvdmlkZXJFdmVudEJ1cyB9IGZyb20gJy4vX2V2ZW50LWJ1cydcblxuY29uc3QgZ2V0QWRkcmVzcyA9IChwdWJsaWNLZXk6IFB1YmxpY0tleSB8IG51bGwpOiBzdHJpbmcgPT4ge1xuICByZXR1cm4gcHVibGljS2V5ID8gbmV3IFB1YmxpY0tleShwdWJsaWNLZXkpLnRvQmFzZTU4KCkgOiAnJ1xufVxuXG5leHBvcnQgY2xhc3MgQmFzZVNvbGFuYVByb3ZpZGVyXG4gIGV4dGVuZHMgUHJvdmlkZXJFdmVudEJ1c1xuICBpbXBsZW1lbnRzIFByb3ZpZGVyUHJveHlcbntcbiAgcmVhZG9ubHkgcHJvdmlkZXI6IFNvbGFuYVByb3ZpZGVyXG4gIHJhd1Byb3ZpZGVyOiBSYXdQcm92aWRlclxuXG4gIGNoYWluSWQ/OiBDaGFpbklkXG4gIGFkZHJlc3M/OiBzdHJpbmdcblxuICBjb25zdHJ1Y3Rvcihwcm92aWRlcjogUmF3UHJvdmlkZXIpIHtcbiAgICBzdXBlcigpXG4gICAgdGhpcy5wcm92aWRlciA9IHByb3ZpZGVyIGFzIFNvbGFuYVByb3ZpZGVyXG5cbiAgICB0aGlzLnJhd1Byb3ZpZGVyID0gcHJvdmlkZXJcbiAgfVxuXG4gIGdldCBjaGFpblR5cGUoKTogQ0hBSU5fVFlQRVMge1xuICAgIHJldHVybiBDSEFJTl9UWVBFUy5Tb2xhbmFcbiAgfVxuXG4gIGdldCBpc0Nvbm5lY3RlZCgpOiBib29sZWFuIHtcbiAgICByZXR1cm4gQm9vbGVhbih0aGlzLmNoYWluSWQgJiYgdGhpcy5hZGRyZXNzKVxuICB9XG5cbiAgZ2V0IGRlZmF1bHRFdmVudFBheWxvYWQoKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGNoYWluSWQ6IHRoaXMuY2hhaW5JZCxcbiAgICAgIGFkZHJlc3M6IHRoaXMuYWRkcmVzcyxcbiAgICAgIGlzQ29ubmVjdGVkOiB0aGlzLmlzQ29ubmVjdGVkLFxuICAgIH1cbiAgfVxuXG4gIGFzeW5jIGluaXQoKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgdGhpcy5zZXRMaXN0ZW5lcnMoKVxuICAgIHRoaXMuYWRkcmVzcyA9IGdldEFkZHJlc3ModGhpcy5wcm92aWRlci5wdWJsaWNLZXkpXG4gICAgdGhpcy5jaGFpbklkID0gU09MQU5BX0NIQUlOUy5EZXZOZXRcblxuICAgIHRoaXMuZW1pdChQUk9WSURFUl9FVkVOVF9CVVNfRVZFTlRTLkluaXRpYXRlZCwgdGhpcy5kZWZhdWx0RXZlbnRQYXlsb2FkKVxuICB9XG5cbiAgYXN5bmMgc3dpdGNoQ2hhaW4oY2hhaW5JZDogQ2hhaW5JZCkge1xuICAgIHRyeSB7XG4gICAgICB0aGlzLmNoYWluSWQgPSBjaGFpbklkXG4gICAgICB0aGlzLmVtaXQoXG4gICAgICAgIFBST1ZJREVSX0VWRU5UX0JVU19FVkVOVFMuQ2hhaW5DaGFuZ2VkLFxuICAgICAgICB0aGlzLmRlZmF1bHRFdmVudFBheWxvYWQsXG4gICAgICApXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGhhbmRsZVNvbEVycm9yKGVycm9yIGFzIFNvbGFuYVByb3ZpZGVyUnBjRXJyb3IpXG4gICAgfVxuICB9XG5cbiAgYXN5bmMgY29ubmVjdCgpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICB0cnkge1xuICAgICAgYXdhaXQgdGhpcy5wcm92aWRlci5jb25uZWN0KClcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgaGFuZGxlU29sRXJyb3IoZXJyb3IgYXMgU29sYW5hUHJvdmlkZXJScGNFcnJvcilcbiAgICB9XG4gIH1cblxuICBnZXRBZGRyZXNzVXJsKGNoYWluOiBDaGFpbiwgYWRkcmVzczogc3RyaW5nKTogc3RyaW5nIHtcbiAgICByZXR1cm4gZ2V0U29sRXhwbG9yZXJBZGRyZXNzVXJsKGNoYWluLCBhZGRyZXNzKVxuICB9XG5cbiAgZ2V0VHhVcmwoY2hhaW46IENoYWluLCB0eEhhc2g6IHN0cmluZyk6IHN0cmluZyB7XG4gICAgcmV0dXJuIGdldFNvbEV4cGxvcmVyVHhVcmwoY2hhaW4sIHR4SGFzaClcbiAgfVxuXG4gIGdldEhhc2hGcm9tVHgodHhSZXNwb25zZTogVHJhbnNhY3Rpb25SZXNwb25zZSk6IHN0cmluZyB7XG4gICAgcmV0dXJuIHR4UmVzcG9uc2UgYXMgU29sYW5hVHJhbnNhY3Rpb25SZXNwb25zZVxuICB9XG5cbiAgYXN5bmMgc2lnbkFuZFNlbmRUeChcbiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L2Jhbi10cy1jb21tZW50XG4gICAgLy8gQHRzLWlnbm9yZVxuICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tdW51c2VkLXZhcnNcbiAgICB0eFJlcXVlc3RCb2R5OiBUeFJlcXVlc3RCb2R5LFxuICApOiBQcm9taXNlPFRyYW5zYWN0aW9uUmVzcG9uc2U+IHtcbiAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdNZXRob2Qgc2hvdWxkIGJlIGltcGxlbWVudGVkIGluIGV4dGVuZGVyIGNsYXNzJylcbiAgfVxuXG4gIHNldExpc3RlbmVycygpIHtcbiAgICB0aGlzLnByb3ZpZGVyLm9uKFBST1ZJREVSX0VWRU5UUy5Db25uZWN0LCAoKSA9PiB7XG4gICAgICB0aGlzLmFkZHJlc3MgPSBnZXRBZGRyZXNzKHRoaXMucHJvdmlkZXIucHVibGljS2V5KVxuXG4gICAgICB0aGlzLmVtaXQoUFJPVklERVJfRVZFTlRfQlVTX0VWRU5UUy5Db25uZWN0LCB0aGlzLmRlZmF1bHRFdmVudFBheWxvYWQpXG4gICAgfSlcblxuICAgIHRoaXMucHJvdmlkZXIub24oUFJPVklERVJfRVZFTlRTLkRpc2Nvbm5lY3QsICgpID0+IHtcbiAgICAgIHRoaXMuYWRkcmVzcyA9IGdldEFkZHJlc3ModGhpcy5wcm92aWRlci5wdWJsaWNLZXkpXG5cbiAgICAgIHRoaXMuZW1pdChQUk9WSURFUl9FVkVOVF9CVVNfRVZFTlRTLkRpc2Nvbm5lY3QsIHRoaXMuZGVmYXVsdEV2ZW50UGF5bG9hZClcbiAgICB9KVxuXG4gICAgdGhpcy5wcm92aWRlci5vbihQUk9WSURFUl9FVkVOVFMuQWNjb3VudENoYW5nZWQsICgpID0+IHtcbiAgICAgIHRoaXMuYWRkcmVzcyA9IGdldEFkZHJlc3ModGhpcy5wcm92aWRlci5wdWJsaWNLZXkpXG5cbiAgICAgIHRoaXMuZW1pdChcbiAgICAgICAgUFJPVklERVJfRVZFTlRfQlVTX0VWRU5UUy5BY2NvdW50Q2hhbmdlZCxcbiAgICAgICAgdGhpcy5kZWZhdWx0RXZlbnRQYXlsb2FkLFxuICAgICAgKVxuICAgIH0pXG4gIH1cbn1cbiJdLCJuYW1lcyI6WyJCYXNlU29sYW5hUHJvdmlkZXIiLCJnZXRBZGRyZXNzIiwicHVibGljS2V5IiwiUHVibGljS2V5IiwidG9CYXNlNTgiLCJQcm92aWRlckV2ZW50QnVzIiwiY2hhaW5UeXBlIiwiQ0hBSU5fVFlQRVMiLCJTb2xhbmEiLCJpc0Nvbm5lY3RlZCIsIkJvb2xlYW4iLCJjaGFpbklkIiwiYWRkcmVzcyIsImRlZmF1bHRFdmVudFBheWxvYWQiLCJpbml0Iiwic2V0TGlzdGVuZXJzIiwicHJvdmlkZXIiLCJTT0xBTkFfQ0hBSU5TIiwiRGV2TmV0IiwiZW1pdCIsIlBST1ZJREVSX0VWRU5UX0JVU19FVkVOVFMiLCJJbml0aWF0ZWQiLCJzd2l0Y2hDaGFpbiIsIkNoYWluQ2hhbmdlZCIsImVycm9yIiwiaGFuZGxlU29sRXJyb3IiLCJjb25uZWN0IiwiZ2V0QWRkcmVzc1VybCIsImNoYWluIiwiZ2V0U29sRXhwbG9yZXJBZGRyZXNzVXJsIiwiZ2V0VHhVcmwiLCJ0eEhhc2giLCJnZXRTb2xFeHBsb3JlclR4VXJsIiwiZ2V0SGFzaEZyb21UeCIsInR4UmVzcG9uc2UiLCJzaWduQW5kU2VuZFR4IiwidHhSZXF1ZXN0Qm9keSIsIlR5cGVFcnJvciIsIm9uIiwiUFJPVklERVJfRVZFTlRTIiwiQ29ubmVjdCIsIkRpc2Nvbm5lY3QiLCJBY2NvdW50Q2hhbmdlZCIsImNvbnN0cnVjdG9yIiwicmF3UHJvdmlkZXIiXSwicmFuZ2VNYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7IiwibWFwcGluZ3MiOiI7Ozs7K0JBK0JhQTs7O2VBQUFBOzs7c0JBL0JhO3VCQU9uQjt3QkFLQTswQkFhMEI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFFakMsTUFBTUMsYUFBYSxDQUFDQztJQUNsQixPQUFPQSxZQUFZLElBQUlDLGVBQVMsQ0FBQ0QsV0FBV0UsUUFBUSxLQUFLO0FBQzNEO0FBRU8sSUFBQSxBQUFNSixxQkFBTixNQUFNQSwyQkFDSEssMEJBQWdCO0lBZ0J4QixJ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