"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
Object.defineProperty(exports, "PhantomProvider", {
    enumerable: true,
    get: function() {
        return PhantomProvider;
    }
});
const _web3 = require("@solana/web3.js");
const _enums = require("../../enums");
const _solana = require("../../helpers/solana");
const _basesolana = require("./_base-solana");
function asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) {
    try {
        var info = gen[key](arg);
        var value = info.value;
    } catch (error) {
        reject(error);
        return;
    }
    if (info.done) {
        resolve(value);
    } else {
        Promise.resolve(value).then(_next, _throw);
    }
}
function _async_to_generator(fn) {
    return function() {
        var self = this, args = arguments;
        return new Promise(function(resolve, reject) {
            var gen = fn.apply(self, args);
            function _next(value) {
                asyncGeneratorStep(gen, resolve, reject, _next, _throw, "next", value);
            }
            function _throw(err) {
                asyncGeneratorStep(gen, resolve, reject, _next, _throw, "throw", err);
            }
            _next(undefined);
        });
    };
}
/**
 * @description Represents a Phantom wallet.
 *
 * @example
 * ```js
 * import { createProvider, PhantomProvider } from '@rarimo/provider'
 *
 * const getPhantomWalletAddress = async () => {
 *   // Connect to the Phantom wallet in the browser using Web3.js, using the PhantomProvider interface to limit bundle size.
 *   const provider = await createProvider(PhantomProvider)
 *   await provider.connect()
 *
 *   // Get the address of the wallet
 *   console.log(provider.address)
 * }
 * ```
 */ let PhantomProvider = class PhantomProvider extends _basesolana.BaseSolanaProvider {
    static get providerType() {
        return _enums.PROVIDERS.Phantom;
    }
    signAndSendTx(txRequestBody) {
        var _this = this;
        return _async_to_generator(function*() {
            try {
                const txBody = typeof txRequestBody === 'string' ? (0, _solana.decodeSolanaTx)(txRequestBody) : txRequestBody;
                _this.emit(_enums.PROVIDER_EVENT_BUS_EVENTS.BeforeTxSent, {
                    txBody
                });
                const connection = new _web3.Connection((0, _web3.clusterApiUrl)(_this.chainId));
                const { signature } = yield _this.provider.signAndSendTransaction(txBody);
                _this.emit(_enums.PROVIDER_EVENT_BUS_EVENTS.TxSent, {
                    txHash: signature
                });
                yield connection.confirmTransaction(signature);
                _this.emit(_enums.PROVIDER_EVENT_BUS_EVENTS.TxConfirmed, {
                    txResponse: signature
                });
                return signature;
            } catch (error) {
                (0, _solana.handleSolError)(error);
            }
            return '';
        })();
    }
    constructor(provider){
        super(provider);
    }
};

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9wcm92aWRlcnMvd3JhcHBlZC9waGFudG9tLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIHR5cGUgQ2x1c3RlcixcbiAgY2x1c3RlckFwaVVybCxcbiAgQ29ubmVjdGlvbixcbiAgdHlwZSBUcmFuc2FjdGlvbiBhcyBTb2xUcmFuc2FjdGlvbixcbn0gZnJvbSAnQHNvbGFuYS93ZWIzLmpzJ1xuXG5pbXBvcnQgeyBQUk9WSURFUl9FVkVOVF9CVVNfRVZFTlRTLCBQUk9WSURFUlMgfSBmcm9tICdAL2VudW1zJ1xuaW1wb3J0IHsgZGVjb2RlU29sYW5hVHgsIGhhbmRsZVNvbEVycm9yIH0gZnJvbSAnQC9oZWxwZXJzL3NvbGFuYSdcbmltcG9ydCB0eXBlIHtcbiAgUHJvdmlkZXJQcm94eSxcbiAgUmF3UHJvdmlkZXIsXG4gIFNvbGFuYVByb3ZpZGVyUnBjRXJyb3IsXG4gIFRyYW5zYWN0aW9uUmVzcG9uc2UsXG4gIFR4UmVxdWVzdEJvZHksXG59IGZyb20gJ0AvdHlwZXMnXG5cbmltcG9ydCB7IEJhc2VTb2xhbmFQcm92aWRlciB9IGZyb20gJy4vX2Jhc2Utc29sYW5hJ1xuXG4vKipcbiAqIEBkZXNjcmlwdGlvbiBSZXByZXNlbnRzIGEgUGhhbnRvbSB3YWxsZXQuXG4gKlxuICogQGV4YW1wbGVcbiAqIGBgYGpzXG4gKiBpbXBvcnQgeyBjcmVhdGVQcm92aWRlciwgUGhhbnRvbVByb3ZpZGVyIH0gZnJvbSAnQHJhcmltby9wcm92aWRlcidcbiAqXG4gKiBjb25zdCBnZXRQaGFudG9tV2FsbGV0QWRkcmVzcyA9IGFzeW5jICgpID0+IHtcbiAqICAgLy8gQ29ubmVjdCB0byB0aGUgUGhhbnRvbSB3YWxsZXQgaW4gdGhlIGJyb3dzZXIgdXNpbmcgV2ViMy5qcywgdXNpbmcgdGhlIFBoYW50b21Qcm92aWRlciBpbnRlcmZhY2UgdG8gbGltaXQgYnVuZGxlIHNpemUuXG4gKiAgIGNvbnN0IHByb3ZpZGVyID0gYXdhaXQgY3JlYXRlUHJvdmlkZXIoUGhhbnRvbVByb3ZpZGVyKVxuICogICBhd2FpdCBwcm92aWRlci5jb25uZWN0KClcbiAqXG4gKiAgIC8vIEdldCB0aGUgYWRkcmVzcyBvZiB0aGUgd2FsbGV0XG4gKiAgIGNvbnNvbGUubG9nKHByb3ZpZGVyLmFkZHJlc3MpXG4gKiB9XG4gKiBgYGBcbiAqL1xuZXhwb3J0IGNsYXNzIFBoYW50b21Qcm92aWRlclxuICBleHRlbmRzIEJhc2VTb2xhbmFQcm92aWRlclxuICBpbXBsZW1lbnRzIFByb3ZpZGVyUHJveHlcbntcbiAgY29uc3RydWN0b3IocHJvdmlkZXI6IFJhd1Byb3ZpZGVyKSB7XG4gICAgc3VwZXIocHJvdmlkZXIpXG4gIH1cblxuICBzdGF0aWMgZ2V0IHByb3ZpZGVyVHlwZSgpOiBQUk9WSURFUlMge1xuICAgIHJldHVybiBQUk9WSURFUlMuUGhhbnRvbVxuICB9XG5cbiAgYXN5bmMgc2lnbkFuZFNlbmRUeChcbiAgICB0eFJlcXVlc3RCb2R5OiBUeFJlcXVlc3RCb2R5LFxuICApOiBQcm9taXNlPFRyYW5zYWN0aW9uUmVzcG9uc2U+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgdHhCb2R5ID1cbiAgICAgICAgdHlwZW9mIHR4UmVxdWVzdEJvZHkgPT09ICdzdHJpbmcnXG4gICAgICAgICAgPyBkZWNvZGVTb2xhbmFUeCh0eFJlcXVlc3RCb2R5KVxuICAgICAgICAgIDogdHhSZXF1ZXN0Qm9keVxuXG4gICAgICB0aGlzLmVtaXQoUFJPVklERVJfRVZFTlRfQlVTX0VWRU5UUy5CZWZvcmVUeFNlbnQsIHsgdHhCb2R5IH0pXG5cbiAgICAgIGNvbnN0IGNvbm5lY3Rpb24gPSBuZXcgQ29ubmVjdGlvbihjbHVzdGVyQXBpVXJsKHRoaXMuY2hhaW5JZCBhcyBDbHVzdGVyKSlcblxuICAgICAgY29uc3QgeyBzaWduYXR1cmUgfSA9IGF3YWl0IHRoaXMucHJvdmlkZXIuc2lnbkFuZFNlbmRUcmFuc2FjdGlvbihcbiAgICAgICAgdHhCb2R5IGFzIFNvbFRyYW5zYWN0aW9uLFxuICAgICAgKVxuXG4gICAgICB0aGlzLmVtaXQoUFJPVklERVJfRVZFTlRfQlVTX0VWRU5UUy5UeFNlbnQsIHtcbiAgICAgICAgdHhIYXNoOiBzaWduYXR1cmUsXG4gICAgICB9KVxuXG4gICAgICBhd2FpdCBjb25uZWN0aW9uLmNvbmZpcm1UcmFuc2FjdGlvbihzaWduYXR1cmUpXG5cbiAgICAgIHRoaXMuZW1pdChQUk9WSURFUl9FVkVOVF9CVVNfRVZFTlRTLlR4Q29uZmlybWVkLCB7XG4gICAgICAgIHR4UmVzcG9uc2U6IHNpZ25hdHVyZSxcbiAgICAgIH0pXG5cbiAgICAgIHJldHVybiBzaWduYXR1cmVcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgaGFuZGxlU29sRXJyb3IoZXJyb3IgYXMgU29sYW5hUHJvdmlkZXJScGNFcnJvcilcbiAgICB9XG5cbiAgICByZXR1cm4gJydcbiAgfVxufVxuIl0sIm5hbWVzIjpbIlBoYW50b21Qcm92aWRlciIsIkJhc2VTb2xhbmFQcm92aWRlciIsInByb3ZpZGVyVHlwZSIsIlBST1ZJREVSUyIsIlBoYW50b20iLCJzaWduQW5kU2VuZFR4IiwidHhSZXF1ZXN0Qm9keSIsInR4Qm9keSIsImRlY29kZVNvbGFuYVR4IiwiZW1pdCIsIlBST1ZJREVSX0VWRU5UX0JVU19FVkVOVFMiLCJCZWZvcmVUeFNlbnQiLCJjb25uZWN0aW9uIiwiQ29ubmVjdGlvbiIsImNsdXN0ZXJBcGlVcmwiLCJjaGFpbklkIiwic2lnbmF0dXJlIiwicHJvdmlkZXIiLCJzaWduQW5kU2VuZFRyYW5zYWN0aW9uIiwiVHhTZW50IiwidHhIYXNoIiwiY29uZmlybVRyYW5zYWN0aW9uIiwiVHhDb25maXJtZWQiLCJ0eFJlc3BvbnNlIiwiZXJyb3IiLCJoYW5kbGVTb2xFcnJvciIsImNvbnN0cnVjdG9yIl0sInJhbmdlTWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OzsiLCJtYXBwaW5ncyI6Ijs7OzsrQkFvQ2FBOzs7ZUFBQUE7OztzQkEvQk47dUJBRThDO3dCQUNOOzRCQVNaOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFFbkM7Ozs7Ozs7Ozs7Ozs7Ozs7Q0FnQkMsR0FDTSxJQUFBLEFBQU1BLGtCQUFOLE1BQU1BLHdCQUNIQyw4QkFBa0I7SUFPMUIsV0FBV0MsZUFBMEI7UUFDbkMsT0FBT0MsZ0JBQVMsQ0FBQ0MsT0FBTztJQUMxQjtJQUVNQyxjQUNKQyxhQUE0Qjs7ZUFEOUIsb0JBQUE7WUFHRSxJQUFJO2dCQUNGLE1BQU1DLFNBQ0osT0FBT0Qsa0JBQWtCLFdBQ3JCRSxJQUFBQSxzQkFBYyxFQUFDRixpQkFDZkE7Z0JBRU4sTUFBS0csSUFBSSxDQUFDQyxnQ0FBeUIsQ0FBQ0MsWUFBWSxFQUFFO29CQUFFSjtnQkFBTztnQkFFM0QsTUFBTUssYUFBYSxJQUFJQyxnQkFBVSxDQUFDQyxJQUFBQSxtQkFBYSxFQUFDLE1BQUtDLE9BQU87Z0JBRTVELE1BQU0sRUFBRUMsU0FBUyxFQUFFLEdBQUcsTUFBTSxNQUFLQyxRQUFRLENBQUNDLHNCQUFzQixDQUM5RFg7Z0JBR0YsTUFBS0UsSUFBSSxDQUFDQyxnQ0FBeUIsQ0FBQ1MsTUFBTSxFQUFFO29CQUMxQ0MsUUFBUUo7Z0JBQ1Y7Z0JBRUEsTUFBTUosV0FBV1Msa0JBQWtCLENBQUNMO2dCQUVwQyxNQUFLUCxJQUFJLENBQUNDLGdDQUF5QixDQUFDWSxXQUFXLEVBQUU7b0JBQy9DQyxZQUFZUDtnQkFDZDtnQkFFQSxPQUFPQTtZQUNULEVBQUUsT0FBT1EsT0FBTztnQkFDZEMsSUFBQUEsc0JBQWMsRUFBQ0Q7WUFDakI7WUFFQSxPQUFPO1FBQ1Q7O0lBekNBRSxZQUFZVCxRQUFxQixDQUFFO1FBQ2pDLEtBQUssQ0FBQ0E7SUFDUjtBQXdDRiJ9